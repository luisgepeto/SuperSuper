const i="supersuper-v1",c=["/SuperSuper/pr-18/"];self.addEventListener("install",e=>{console.log("[ServiceWorker] Installing..."),e.waitUntil(caches.open(i).then(r=>(console.log("[ServiceWorker] Caching app shell"),r.addAll(c))).then(()=>(console.log("[ServiceWorker] Skip waiting on install"),self.skipWaiting())))});self.addEventListener("activate",e=>{console.log("[ServiceWorker] Activating..."),e.waitUntil(caches.keys().then(r=>Promise.all(r.map(t=>{if(t!==i)return console.log("[ServiceWorker] Removing old cache:",t),caches.delete(t)}))).then(()=>(console.log("[ServiceWorker] Claiming clients"),self.clients.claim())))});self.addEventListener("fetch",e=>{if(e.request.url.startsWith(self.location.origin)){if(e.request.url.includes("/api/")){e.respondWith(l(e.request));return}if(e.request.mode==="navigate"){e.respondWith(u(e.request));return}e.respondWith(h(e.request))}});async function l(e){const r=await caches.open(i);try{const t=new AbortController,n=setTimeout(()=>t.abort(),8e3),o=await fetch(e,{signal:t.signal});if(clearTimeout(n),o.ok)return r.put(e,o.clone()),o;if(o.status>=400){console.log(`[ServiceWorker] API returned ${o.status}, checking cache:`,e.url);const s=await r.match(e);return s?(console.log("[ServiceWorker] Serving cached response for failed API request"),s):o}return o}catch(t){console.log("[ServiceWorker] API request failed:",t.message,e.url);const n=t.name==="AbortError",o=t.message.includes("fetch"),s=await r.match(e);if(s)return console.log("[ServiceWorker] Serving cached response for network failure"),s;const a={error:"Service Unavailable",message:n?"Request timed out - server may be unavailable":o?"Network error - check your connection":"Backend server is not responding",offline:!0,canRetry:!0,errorType:n?"timeout":o?"network":"backend"};return new Response(JSON.stringify(a),{status:503,statusText:"Service Unavailable",headers:{"Content-Type":"application/json"}})}}async function u(e){const r=await caches.open(i);try{return await fetch(e)}catch{console.log("[ServiceWorker] Navigation request failed, serving cached content");const n=await r.match("/SuperSuper/pr-18/");return n||new Response(`
      <!DOCTYPE html>
      <html>
        <head><title>SuperSuper - Offline</title></head>
        <body style="font-family: system-ui; text-align: center; padding: 2rem;">
          <h1>You're Offline</h1>
          <p>Please check your connection and try again.</p>
          <button onclick="location.reload()">Retry</button>
        </body>
      </html>
    `,{headers:{"Content-Type":"text/html"}})}}async function h(e){const r=await caches.open(i),t=await r.match(e);if(t)return t;try{const n=await fetch(e);return n.ok&&r.put(e,n.clone()),n}catch{return console.log("[ServiceWorker] Asset request failed:",e.url),e.url.includes(".css")?new Response("/* Offline CSS fallback */",{headers:{"Content-Type":"text/css"}}):new Response("Offline",{status:503})}}self.addEventListener("message",e=>{e.data&&e.data.type==="SKIP_WAITING"&&self.skipWaiting()});
